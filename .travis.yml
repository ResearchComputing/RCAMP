sudo: required

language: python

services:
  - docker

before_install:
- pip install --upgrade docker-compose
- cd rcamp
- docker build -t dev/rcamp --build-arg UWSGI_UID=$(id -u) --build-arg UWSGI_GID=$(id -u) .
- cd ..
- export RCAMP_PORT=9000
- docker-compose -f docker-compose.yml -f docker-compose.test-backends.yml -f docker-compose.dev.yml build
- docker-compose -f docker-compose.yml -f docker-compose.test-backends.yml -f docker-compose.dev.yml run --rm --service-ports rcamp-uwsgi bash -c 'sleep 30s && python manage.py migrate'
- docker-compose -f docker-compose.yml -f docker-compose.test-backends.yml -f docker-compose.dev.yml run --rm --service-ports rcamp-uwsgi bash -c 'python manage.py test'

install: true
script: true

notifications:
  email: false
  slack: sYS9x5E2wsNxniYIGuKasqQ3TQtzv/AgyG83e0FhINCI6A/EWm8kvvUKhlWzqgSm2e2AnFqpxHJZPATT9bs16EvksYzL11BZq9F5NQy6/pszZSLfcH+0o73V84L+1d67qWUBFHsb2X3A65G4G70YtDKG8bQ/h83SB7GK91Gtt4Fspe7XoW8QTmZUwehKX0HuBqvAlDUEtca0lfyxvPo+GCm9Mhqj6ejMsGzN7niU3gH8pWasofbEfUztR9KURnSsv+xtzjHaAIxPOxbehsg95eORUMTwB+g705isOKfKrt/PgiwCHMJcrVL4hrXILX2lvMpkWzhfPmZ9hjmrmAc29nkaJpZzHm9Nl7qRcRTGk6ju5M9v6aIwa39N5xNcnr1j17PbtQRkzj0FJrjyPe9ub8IKq9v8AxOLKErz/DW2rs2Xl+N4aB81F9jMt4AeOPPsbPwOYbm15Bttu/1nSRBU4dA7mgE2u9ZkBKvNeDX59b5s2F2mLwf6DJknNnezf2MsZEZ0Xln3Ij+LIlwgAt2jaTfdjUndXX1IBYD+POvGTz14aTt3sKmI3uwR//fm2ebEzHpy7alIkz2oE0zNWNW+FeGptKv9ehtiozxoqyMbAdn9hJlOBMf3wOCSuhV8S7UB4xU4pYFoJVraj4k9B8zg4y41Z0XT9bggrdB1EOzHpMI=
